<div class="comment" [class.reply]="isReply">
  <div class="comment-header">
    <img
      [src]="comment.userAvatarUrl"
      alt="User avatar"
      class="comment-avatar"
    />
    <div class="comment-user-info">
      <span class="comment-username">{{ comment.userName }}</span>
      <span class="comment-date">{{
        comment.createdAt | date : "medium"
      }}</span>
    </div>
  </div>

  <div class="comment-content">
    <div *ngIf="!isEditing; else editMode">
      <p>{{ comment.content }}</p>
    </div>
    <ng-template #editMode>
      <textarea
        [(ngModel)]="editedContent"
        class="comment-edit-textarea"
      ></textarea>
      <div class="comment-edit-actions">
        <button (click)="onCancel()" mat-raised-button>Cancel</button>
        <button (click)="onSave()" mat-raised-button>Save</button>
      </div>
    </ng-template>
  </div>

  @if (!isEditing) {
  <div class="comment-actions">
    @if (currentUserId !== comment.userId) {

    <button (click)="onReply()" class="comment-action">Reply</button>
    }
    <button
      (click)="onLikeToggle()"
      class="comment-action like-button"
      [disabled]="isLiking"
      [class.liked]="comment.isLikedByCurrentUser"
      [class.disabled]="comment.userId === currentUserId"
    >
      @if(!isLiking) {
      <span
        >{{ comment.isLikedByCurrentUser ? "Unlike" : "Like" }} ({{
          comment.likes
        }})
      </span>

      } @else {
      <span>Processing...</span>
      }
    </button>
    <button
      *ngIf="isCurrentUserComment()"
      (click)="onEdit()"
      class="comment-action"
    >
      Edit
    </button>
    <button
      *ngIf="isCurrentUserComment()"
      (click)="onDelete()"
      class="comment-action"
    >
      Delete
    </button>
  </div>
  }
</div>
