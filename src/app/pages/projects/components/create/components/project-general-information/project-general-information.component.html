@let tags = tags$ | async;

<form
  [formGroup]="generalInformationForm()"
  class="project-general-information__form"
>
  <mat-form-field>
    <mat-label>Title</mat-label>
    <input
      matInput
      placeholder="Creation of a new graphics render model"
      formControlName="title"
    />
  </mat-form-field>
  <div style="display: flex; flex-direction: column">
    <mat-label>Progress</mat-label>
    <mat-slider min="0" max="100" step="1" showTickMarks discrete>
      <input
        matSliderThumb
        [formControl]="generalInformationForm().controls.progress"
      />
    </mat-slider>
  </div>
  <mat-form-field>
    <mat-label>Description</mat-label>
    <textarea
      matInput
      placeholder="A new model for the graphics render"
      formControlName="description"
    ></textarea>
  </mat-form-field>
  <mat-form-field>
    <mat-label>Tags</mat-label>
    <mat-select formControlName="tags" multiple [compareWith]="compareTags">
      <input placeholder="Custom tag" />
      @for (tag of tags$ | async; track tag.id) {
      <mat-option [value]="tag.id">{{ tag.name }}</mat-option>
      }
    </mat-select>
  </mat-form-field>

  <div class="file-upload-container">
    <input
      type="file"
      #fileInput
      multiple
      (change)="onFilesSelected($event)"
      style="display: none"
    />

    <button mat-button color="primary" (click)="fileInput.click()">
      <mat-icon>attach_file</mat-icon>
      Select Files
    </button>

    <button
      mat-button
      color="accent"
      (click)="uploadFiles()"
      [disabled]="!pendingFiles().length || isUploading()"
    >
      <mat-icon>cloud_upload</mat-icon>
      Upload Selected ({{ pendingFiles().length }})
    </button>

    @if (isUploading()) {
    <mat-progress-bar mode="determinate" [value]="uploadProgress()">
    </mat-progress-bar>
    }

    <mat-list class="file-list">
      @for (file of pendingFiles(); track file.name; let i = $index) {
      <mat-list-item>
        <mat-icon matListItemIcon>insert_drive_file</mat-icon>
        <div matListItemTitle>{{ file.name }}</div>
        <div matListItemLine>{{ file.size | fileSize }}</div>
        <button mat-icon-button (click)="removeFile(i, true)">
          <mat-icon>delete</mat-icon>
        </button> </mat-list-item
      >} @for(file of uploadedFiles(); track file.fileUrl; let i = $index) {
      <mat-list-item>
        <mat-icon matListItemIcon>description</mat-icon>
        <div matListItemTitle>{{ file.fileName }}</div>
        <div matListItemLine>
          {{ file.fileSize ? (file.fileSize | fileSize) : "Size unknown" }} â€¢
          Uploaded {{ file.uploadedAt | date }}
          @if(file.entityType) {
          <span>({{ file.entityType }})</span>
          }
        </div>
        <a
          mat-icon-button
          [href]="file.fileUrl"
          target="_blank"
          matTooltip="View file"
        >
          <mat-icon>visibility</mat-icon>
        </a>
        <button mat-icon-button (click)="removeFile(i, false)">
          <mat-icon>delete</mat-icon>
        </button>
      </mat-list-item>
      }
    </mat-list>
  </div>
  <div>
    <button mat-button matStepperPrevious>Back</button>
    <button
      mat-button
      matStepperNext
      [disabled]="generalInformationForm().invalid"
    >
      Next
    </button>
  </div>
</form>
