<p
  style="
    text-align: center;
    font-size: 20px;
    line-height: 24px;
    font-weight: 500;
    padding: 15px 0;
  "
>
  {{ subtext }}
</p>
<mat-stepper #stepper orientation="vertical">
  <mat-step
    [stepControl]="typeForm"
    label="Select a project type"
    errorMessage="Type is required."
  >
    <form
      [formGroup]="typeForm"
      style="display: flex; flex-direction: column; gap: 10px; padding: 15px 0"
    >
      <mat-form-field>
        <mat-label>Type</mat-label>
        <mat-select formControlName="type">
          @for (type of types; track type) {
          <mat-option [value]="type.value">{{ type.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <div>
        <button mat-button matStepperNext [disabled]="typeForm.invalid">
          Next
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step
    [stepControl]="generalInformationForm"
    errorMessage="General information is required."
  >
    <form
      [formGroup]="generalInformationForm"
      style="display: flex; flex-direction: column; gap: 10px; padding: 15px 0"
    >
      <ng-template matStepLabel>Fill out general information</ng-template>
      <mat-form-field>
        <mat-label>Title</mat-label>
        <input
          matInput
          placeholder="Creation of a new graphics render model"
          formControlName="title"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Description</mat-label>
        <textarea
          matInput
          placeholder="A new model for the graphics render"
          formControlName="description"
        ></textarea>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Tags</mat-label>
        <mat-select formControlName="tags" multiple>
          <input placeholder="Custom tag" />
          @for (tag of tags; track tag) {
          <mat-option [value]="tag.value">{{ tag.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <shared-multiple-file-upload
        [formField]="generalInformationForm.controls.attachments"
      />

      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button
          mat-button
          matStepperNext
          [disabled]="generalInformationForm.invalid"
        >
          Next
        </button>
      </div>
    </form>
  </mat-step>
  <mat-step
    [stepControl]="
      typeForm.value.type === 'publication'
        ? publicationsForm
        : typeForm.value.type === 'patent'
        ? patentsForm
        : researchProjects
    "
    errorMessage="Type-specific information is required."
    label="Fill out work information"
  >
    @if ( typeForm.value.type === 'publication') {
    <form
      [formGroup]="publicationsForm"
      style="display: flex; flex-direction: column; gap: 10px; padding: 15px 0"
    >
      <mat-form-field>
        <mat-label>Authors</mat-label>
        <input
          type="text"
          placeholder="Author"
          matInput
          formControlName="authors"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
          @for (author of filteredAuthors | async; track author) {
          <mat-option [value]="author">{{ author }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Publication date</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="publicationDate"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Publication source</mat-label>
        <input
          type="text"
          placeholder="Publication source"
          matInput
          formControlName="publicationSource"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>DOI/ISBN</mat-label>
        <input
          type="text"
          placeholder="https://doi.org/10.1080/10509585.2015.1092083"
          matInput
          formControlName="doiIsbn"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Start pages</mat-label>
        <input
          type="number"
          placeholder="10"
          matInput
          formControlName="startPage"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>End pages</mat-label>
        <input
          type="number"
          placeholder="20"
          matInput
          formControlName="endPage"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Journal volume</mat-label>
        <input
          type="number"
          placeholder="1"
          matInput
          formControlName="journalVolume"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Issue Numbers</mat-label>
        <input
          type="number"
          placeholder="1"
          matInput
          formControlName="issueNumbers"
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext [disabled]="publicationsForm.invalid">
          Next
        </button>
      </div>
    </form>
    }@else if ( typeForm.value.type === 'patent') {
    <form
      [formGroup]="patentsForm"
      style="display: flex; flex-direction: column; gap: 10px; padding: 15px 0"
    >
      <mat-form-field>
        <mat-label>Primary author</mat-label>
        <input
          type="text"
          placeholder="Antoni Macierewicz"
          matInput
          formControlName="primaryAuthor"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
          @for (author of filteredPrimaryAuthors | async; track author) {
          <mat-option [value]="author">{{ author }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Co-inventors</mat-label>
        <mat-select formControlName="coInventors" multiple>
          <mat-select-trigger>
            {{patentsForm.value.coInventors?.[0] || ''}}
            @if ((patentsForm.value.coInventors?.length || 0) > 1) {
            <span class="example-additional-selection">
              (+{{ (patentsForm.value.coInventors?.length || 0) - 1 }}
              {{
                patentsForm.value.coInventors?.length === 2
                  ? "other"
                  : "others"
              }})
            </span>
            }
          </mat-select-trigger>
          <input placeholder="Custom tag" />
          @for (coInventor of authors; track coInventor) {
          <mat-option [value]="coInventor">{{ coInventor }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Patent Registration Number</mat-label>
        <input
          type="text"
          placeholder="US 7,654,321 B1"
          matInput
          formControlName="registrationNumber"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Date of Registration</mat-label>
        <input
          matInput
          [matDatepicker]="picker"
          formControlName="registrationDate"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Issuing Authority</mat-label>
        <input
          type="text"
          placeholder="Issuing State"
          matInput
          formControlName="issuingAuthority"
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext [disabled]="patentsForm.invalid">
          Next
        </button>
      </div>
    </form>
    } @if ( typeForm.value.type === 'research') {
    <form
      [formGroup]="researchProjects"
      style="display: flex; flex-direction: column; gap: 10px; padding: 15px 0"
    >
      <mat-form-field>
        <mat-label>Participants</mat-label>
        <input
          type="text"
          placeholder="Andrzej Duda"
          matInput
          formControlName="participants"
          [matAutocomplete]="auto"
        />

        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
          @for (participant of filteredParticipants | async; track participant)
          {
          <mat-option [value]="participant">{{ participant }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <mat-form-field>
        <mat-label>Budget</mat-label>
        <input
          type="number"
          placeholder="1000000"
          matInput
          formControlName="budget"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>Start date</mat-label>
        <input
          matInput
          [matDatepicker]="pickerFirst"
          formControlName="startDate"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="pickerFirst"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerFirst></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>End date</mat-label>
        <input
          matInput
          [matDatepicker]="pickerSecond"
          formControlName="endDate"
        />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="pickerSecond"
        ></mat-datepicker-toggle>
        <mat-datepicker #pickerSecond></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          @for (status of statuses; track status) {
          <mat-option [value]="status.value">{{ status.viewValue }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Funding Source</mat-label>
        <input
          type="text"
          placeholder="U.S. Small Business Administration (SBA)"
          matInput
          formControlName="fundingSource"
        />
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button matStepperNext [disabled]="researchProjects.invalid">
          Next
        </button>
      </div>
    </form>
    }
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Done</ng-template>
    <p>You are now done.</p>
    <div>
      <button mat-button matStepperPrevious>Back</button>
      <button mat-button (click)="stepper.reset()">Reset</button>
    </div>
  </mat-step>
</mat-stepper>
