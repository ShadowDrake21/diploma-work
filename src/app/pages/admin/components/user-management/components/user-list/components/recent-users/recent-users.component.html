<div class="stats-section">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Login Statistics</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (error()) {
      <div class="error-message">
        {{ error() }}
        <button mat-button color="primary" (click)="retryLoadData()">
          Retry
        </button>
      </div>
      } @else if (loginStats() === null) {
      <mat-spinner diameter="30"></mat-spinner>
      } @else {
      <div class="stat-value">
        {{ loginStats()?.data || 0 }} logins in last 24 hours
      </div>
      }
    </mat-card-content>
  </mat-card>
</div>

<div class="recent-logins-section">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Recent Logins</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      @if (error()) {
      <div class="error-message">
        {{ error() }}
        <button mat-button color="primary" (click)="retryLoadData()">
          Retry
        </button>
      </div>
      } @else if(recentLogins() === null) {
      <mat-spinner diameter="30"></mat-spinner>
      } @else {
      <table
        mat-table
        [dataSource]="recentLogins()?.data || []"
        class="mat-elevation-z8"
      >
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>Username</th>
          <td mat-cell *matCellDef="let login">{{ login.username }}</td>
        </ng-container>

        <!-- Email Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let login">{{ login.email }}</td>
        </ng-container>

        <!-- Login Time Column -->
        <ng-container matColumnDef="loginTime">
          <th mat-header-cell *matHeaderCellDef>Login Time</th>
          <td mat-cell *matCellDef="let login">
            {{ login.loginTime | date : "medium" }}
          </td>
        </ng-container>

        <!-- IP Address Column -->
        <ng-container matColumnDef="ipAddress">
          <th mat-header-cell *matHeaderCellDef>IP Address</th>
          <td mat-cell *matCellDef="let login">{{ login.ipAddress }}</td>
        </ng-container>

        <ng-container matColumnDef="userAgent">
          <th mat-header-cell *matHeaderCellDef>User agent</th>
          <td mat-cell *matCellDef="let login">{{ login.userAgent }}</td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
      }
    </mat-card-content>
  </mat-card>
</div>
